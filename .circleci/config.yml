version: 2.1
orbs:
  node: circleci/node@3.0.1

executors:
  mac_exe:
    macos:
      xcode: "11.4.1"

references:
  ## Workspace
  workspace: &workspace ~/workspace

  ## Docker image configurations
  android_config: &android_config
    working_directory: *workspace
    docker:
      - image: circleci/android:api-29
    environment:
      TERM: dumb
      _JAVA_OPTIONS: "-Xmx2048m -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap"
      GRADLE_OPTS: '-Dorg.gradle.jvmargs="-Xmx2048m"'

commands:
  shell-script-command:
    description: "Testing command"
    steps:
      - run: sh ./scripts/generate_new_version.sh

jobs:

  deploy-ocean-tokens:
    <<: *android_config
    steps:
      #- checkout
      - shell-script-command

  install-node-example:
    docker:
      - image: circleci/ruby:2.4.2-jessie-node
    steps:
      - checkout
      - run:
          name: "Update Node.js and npm"
          command: |
            curl -sSL "https://nodejs.org/dist/v11.10.0/node-v11.10.0-linux-x64.tar.xz" | sudo tar --strip-components=2 -xJ -C /usr/local/bin/ node-v11.10.0-linux-x64/bin/node
            curl https://www.npmjs.com/install.sh | sudo bash
      - run:
          name: Check current version of node
          command: node -v

workflows:
  android-test-workflow:
    jobs:
      - install-node-example:
          filters:
            branches:
              only: DSO-33-ocean-ds-lib-gen-automation

      - deploy-ocean-tokens:
          requires:
              - install-node-example
          filters:
            branches:
              only: DSO-33-ocean-ds-lib-gen-automation
